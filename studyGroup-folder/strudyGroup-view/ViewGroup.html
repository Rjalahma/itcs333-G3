<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>View Study Group</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="ViewGroup.css" rel="stylesheet">
    <link href="../StudyGroup.css" rel="stylesheet">
</head>
<body>
    <!-- Header -->
     <!-- //TEST -->
    <header>
        <div class="container">
            <h1>Campus Hub</h1>
        </div>
    </header>

    <!-- Navbar -->
    <nav class="navbar navbar-expand-lg navbar-dark">
        <div class="container-fluid">
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav"
                aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav">
                    <li class="nav-item">
                        <a class="nav-link" href="..\..\index.html">Home</a>
                    </li>
                    <li class="nav-item active">
                        <a class="nav-link" href="#">Study Group Finder <span class="sr-only"></span></a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="..\..\Shahad-Reviews\CourseReviews.html">Course Reviews</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="..\..\course_note_folder\course-note-main.html">Course Notes </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="..\..\marwa project\campusNews.html">Campus News</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="..\..\club-activites_folder\Club_Activities\Club_Activities.html">Club Activities</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="..\..\StudentMarketplace-folder\product\index.html">Student Marketplace</a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <main class="container py-5">
        <a href="../studyGroup-finder/pro.html" class="btn btn-secondary previous">&laquo; Previous</a>
        
        <!-- Loading Indicator -->
        <div id="loader" class="text-center" style="display: none;">
            <div class="spinner-border text-primary" role="status">
                <span class="visually-hidden">Loading...</span>
            </div>
        </div>

        <!-- Error Message -->
        <div id="errorMessage" class="alert alert-danger mt-3" style="display: none;" role="alert"></div>

        <div class="view-page-container row">
            <!-- Group Details Card -->
            <div class="col-md-6">
                <div class="details-card p-4 shadow-sm rounded">
                    <h2 class="details-card-header">Group Details</h2>
                
                    <!-- Group Name -->
                    <div class="details-card-title">Group Name</div>
                    <p class="details-card p" id="groupName"></p>
                    
                    <!-- Description Section -->
                    <div class="details-card-title">Description</div>
                    <p class="details-card p" id="description"></p>
                    
                    <!-- Subject Code -->
                    <div class="details-card-title">Subject Code</div>
                    <p class="details-card p" id="subjectCode"></p>
                    
                    <!-- Academic Year -->
                    <div class="details-card-title">Academic Year</div>
                    <p class="details-card p" id="year"></p>
                    
                    <!-- Location of Study Session -->
                    <div class="details-card-title">Location of Study Session</div>
                    <p class="details-card p" id="location"></p>
                    
                    <!-- Group Members -->
                    <div class="details-card-title">Group Members</div>
                    <p class="details-card p" id="members"></p>
                    
                    <!-- Creator of the Group -->
                    <div class="details-card-title">Creator of the Group</div>
                    <p class="details-card p" id="creator"></p>
        
                    <!-- Join Button -->
                    <button class="btn btn-secondary w-100 mt-2" id="joinButton">Join Group</button>
                    <button class="btn btn-danger w-100 mt-2" id="deleteButton" onclick="deleteGroup()">Delete Group</button>
                    <div class="row mt-2" id="creatorActions" style="display: none;">
                        <div class="col-md-6">
                            <button class="btn btn-red w-100">Remove</button>
                        </div>
                        <div class="col-md-6">
                            <button class="btn btn-secondary w-100">Edit</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Comment Section Card -->
            <div class="col-md-6">
                <div class="comment-card p-4 shadow-sm rounded">
                    <div class="comment-card-header">
                        <h3>Comment Section</h3>
                    </div>
        
                    <!-- Existing Comments -->
                    <div id="commentsContainer"></div>

                    <!-- Comment Posting -->
                    <div class="mt-4">
                        <textarea class="form-control" id="newComment" rows="3" placeholder="Leave a comment..."></textarea>
                        <button class="btn btn-secondary w-100 mt-2" onclick="postComment()">Post Comment</button>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
    <script src="pro.js"></script>
    <script>
        // Get group data from sessionStorage
        const groupData = JSON.parse(sessionStorage.getItem('selectedGroup'));
        
        if (groupData) {
            // Populate group details
            document.getElementById('groupName').textContent = groupData.groupName;
            document.getElementById('description').textContent = groupData.description;
            document.getElementById('subjectCode').textContent = groupData.subjectCode;
            document.getElementById('year').textContent = groupData.year;
            document.getElementById('location').textContent = groupData.location;
            document.getElementById('members').textContent = `${groupData.members.length}/${groupData.maxMembers}`;
            document.getElementById('creator').textContent = groupData.creatorEmail;

            // Show/hide creator actions
            const currentUser = 'current.user@example.com'; // In a real app, this would come from user session
            if (groupData.creatorEmail === currentUser) {
                document.getElementById('creatorActions').style.display = 'flex';
                document.getElementById('joinButton').style.display = 'none';
            }

            // Render comments
            const commentsContainer = document.getElementById('commentsContainer');
            commentsContainer.innerHTML = groupData.comments.map(comment => `
                <p class="comment-card p">
                    <strong>${comment.userName}:</strong> ${comment.message}
                    <small class="text-muted d-block">
                        ${new Date(comment.postedAt).toLocaleString()}
                    </small>
                </p>
            `).join('');
        } else {
            document.getElementById('errorMessage').textContent = 'Group not found';
            document.getElementById('errorMessage').style.display = 'block';
        }

        // Post comment function
        async function postComment() {
            const commentText = document.getElementById('newComment').value.trim();
            if (!commentText) return;

            try {
                const comment = {
                    userName: 'Current User', // In a real app, this would come from user session
                    message: commentText,
                    postedAt: new Date().toISOString()
                };

                const response = await fetch(`https://680bd98c2ea307e081d28408.mockapi.io/studyGroups/${groupData.id}/comments`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(comment)
                });

                if (!response.ok) {
                    throw new Error('Failed to post comment');
                }

                // Add new comment to the UI
                const commentsContainer = document.getElementById('commentsContainer');
                const commentElement = document.createElement('p');
                commentElement.className = 'comment-card p';
                commentElement.innerHTML = `
                    <strong>${comment.userName}:</strong> ${comment.message}
                    <small class="text-muted d-block">
                        ${new Date(comment.postedAt).toLocaleString()}
                    </small>
                `;
                commentsContainer.appendChild(commentElement);

                // Clear the input
                document.getElementById('newComment').value = '';

            } catch (error) {
                console.error('Error posting comment:', error);
                document.getElementById('errorMessage').textContent = 'Failed to post comment';
                document.getElementById('errorMessage').style.display = 'block';
            }
        }

        // Delete group function
        async function deleteGroup() {
            if (!confirm('Are you sure you want to delete this group? This action cannot be undone.')) {
                return;
            }

            try {
                const response = await fetch(`https://680bd98c2ea307e081d28408.mockapi.io/studyGroups/${groupData.id}`, {
                    method: 'DELETE',
                });

                if (!response.ok) {
                    throw new Error('Failed to delete group');
                }

                // Redirect to the study group finder page after successful deletion
                window.location.href = '../studyGroup-finder/pro.html';
            } catch (error) {
                console.error('Error deleting group:', error);
                document.getElementById('errorMessage').textContent = 'Failed to delete group';
                document.getElementById('errorMessage').style.display = 'block';
            }
        }
    </script>
</body>
<!-- //TEST -->
</html>

    